---
globs: *.proto,*_pb2.py
---

# Protocol Buffers Guidelines

## Proto Files
- Use `syntax = "proto3"` at the top of all .proto files
- Follow Google's protobuf style guide for naming conventions
- Place .proto files in the main package directory ([fast_flights/](mdc:fast_flights/))

## Generated Files
- Never manually edit `*_pb2.py` files - they are auto-generated
- Regenerate proto files after any .proto changes using:
  ```bash
  protoc --python_out=. fast_flights/flights.proto
  protoc --python_out=. fast_flights/cookies.proto
  ```

## Working with Protobuf
- Create typed wrapper classes for protobuf messages (see [fast_flights/flights_impl.py](mdc:fast_flights/flights_impl.py))
- Use the `attach()` pattern to populate protobuf messages from typed wrappers
- Serialize with `.SerializeToString()` and deserialize with `.ParseFromString()`
- Base64 encode protobuf data when sending to Google Flights API

## Type Annotations
- Use `TYPE_CHECKING` to avoid runtime imports of protobuf types
- Annotate protobuf message types as `Any` under TYPE_CHECKING block for type checkers

## Common Patterns
```python
# Serialization
info = PB.Info()
# ... populate info ...
raw = info.SerializeToString()
encoded = base64.b64encode(raw)

# Deserialization
raw = base64.b64decode(encoded_string)
pb = PB.SomeMessage()
pb.ParseFromString(raw)
```

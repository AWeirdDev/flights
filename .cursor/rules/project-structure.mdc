---
alwaysApply: true
---

# Fast-Flights Project Structure

## Overview
This is a Python-based Google Flights scraper that uses Protocol Buffers to decode Google's base64-encoded flight data. The project provides a strongly-typed API for fetching flight information.

## Core Architecture

### Main Entry Points
- [fast_flights/__init__.py](mdc:fast_flights/__init__.py) - Public API exports
- [fast_flights/core.py](mdc:fast_flights/core.py) - Primary flight fetching logic with multiple fetch modes

### Key Components

1. **Flight Data & Filters**
   - [fast_flights/flights_impl.py](mdc:fast_flights/flights_impl.py) - Typed implementations of `FlightData`, `Passengers`, and `TFSData`
   - [fast_flights/filter.py](mdc:fast_flights/filter.py) - Filter creation utilities

2. **Protocol Buffers**
   - [fast_flights/flights.proto](mdc:fast_flights/flights.proto) - Flight data protobuf schema
   - [fast_flights/cookies.proto](mdc:fast_flights/cookies.proto) - Cookie/consent protobuf schema
   - [fast_flights/flights_pb2.py](mdc:fast_flights/flights_pb2.py) - Generated protobuf code
   - [fast_flights/cookies_pb2.py](mdc:fast_flights/cookies_pb2.py) - Generated protobuf code

3. **Fetch Strategies**
   - `primp` Client (default) - Fast HTTP client with browser impersonation
   - `fallback_playwright` - Serverless Playwright fallback for blocked requests
   - `local_playwright` - Local Playwright for development/testing
   - `bright_data` - Bright Data proxy service

4. **Data Processing**
   - [fast_flights/schema.py](mdc:fast_flights/schema.py) - Response data models (`Result`, `Flight`)
   - [fast_flights/decoder.py](mdc:fast_flights/decoder.py) - JavaScript data decoder for alternative data source
   - HTML parsing using `selectolax.lexbor`

5. **Generated Code**
   - [fast_flights/_generated_enum.py](mdc:fast_flights/_generated_enum.py) - Auto-generated Airport enum
   - [enums/generate_enums.py](mdc:enums/generate_enums.py) - Script to generate airport enums from CSV

## Fetch Modes
- `common` - Uses primp HTTP client only
- `fallback` - Tries primp, falls back to Playwright if it fails
- `force-fallback` - Forces Playwright usage
- `local` - Uses local Playwright installation
- `bright-data` - Uses Bright Data proxy service

## Data Sources
- `html` - Parses HTML response (default)
- `js` - Parses JavaScript data from `<script>` tags

## Key Patterns
- All date strings should be in ISO format (YYYY-MM-DD)
- Airport codes are 3-letter IATA codes
- Strong typing throughout with dataclasses and typed implementations
- Protobuf used for efficient data serialization
